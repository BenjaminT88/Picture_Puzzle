<!DOCTYPE>

<html>
<head>
  <title>GIF Puzzle - jQuery Plugin</title>
  <link rel="stylesheet" href="../Picture_Puzzle/assets/css/reset.css">
  <style>
      #hiddenImg{
        display: none;
        position: absolute;
        z-index: 2;
      }

  </style>
</head>
<body>
    <form id='btns'>
        <button class="btn btn-primary" data-tileCount="3">Easy</button>
        <button class="btn btn-primary" data-tileCount="4">Medium</button>
        <button class="btn btn-primary" data-tileCount="5">Difficult</button>
        <button class="btn-primary" id="start">Start</button>
    </form>
    <img src="../Picture_Puzzle/assets/images/img_638x957.jpg" alt="hidden" id="hiddenImg">
    <div id="target"></div>
    <script src="https://www.gstatic.com/firebasejs/4.12.0/firebase.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">
        // Initialize the game and create the plugin
        // When the squares swap places, the moving square must always appear on top
        var zi = 1; 
        var tileWidth;
        var tileHeight;
        var tileCount;
        var gameStarted = false;
        var numHint = 5;
        // We increment z-index each time a square is shifted
        // The index of the empty square by default, the 16th square
        var totalTiles;
        // We set the empty tile
        var randomEmptyTile;
        // We set the sequence of tiles
        var tileSequence = [];
        // We captutre the width and height of the current image and tile
        var imgWidth = parseInt($("#hiddenImg").css("width"));
        var imgHeight = parseInt($("#hiddenImg").css("height"));

        $.fn.extend({ sortedTiles:function(pieces){
            // Grab the id of the HTML element into which we are placing the game,
            // it is the selector - "#target" from  $("#target").sortedTiles(150);
            var targetElement = "#" + $(this).attr("id");
            tileWidth = Math.floor(imgWidth / pieces);
            tileHeight = Math.floor(imgHeight / pieces);
            totalTiles = tileCount*tileCount;
            tileSequence = [];
            for (var i=0; i<totalTiles; i++){
                tileSequence.push(i);
            }
            randomEmptyTile = Math.ceil(Math.random() * totalTiles);
            $(targetElement).html("<div id = 'board'></div>");
            $("#board").css({ position:'absolute', width: imgWidth, height: imgHeight});
                // Populate the game board's HTML container with 15 squares
                for (var i = 0; i < totalTiles; i++){
                // A dirty way to create an arbitrary DIV and
                // append it into HTML dynamically
                // Notice each square uses the same image earth_img_638x957.jpg
                // It just uses a different x/y offset for each square
                $("#board").append("<div data-sequence = " + tileSequence[i] + " style = 'position: absolute; left: " + ((i % tileCount) * tileWidth) + "px; top: " + Math.floor(i / tileCount) * tileHeight + "px; width: " + tileWidth + "px; height: " + tileHeight + "px; text-align: center; line-height: " + tileHeight + "px; -moz-box-shadow: inset 0 0 20px #555555; -webkit-box-shadow: inset 0 0 20px #555555; box-shadow: inset 0 0 20px #555555; background: #ffffff url(../Picture_Puzzle/assets/images/img_638x957.jpg) " + (-(tileSequence[i] % tileCount) * tileWidth) + "px " + -Math.floor(tileSequence[i] / tileCount) * tileHeight + "px no-repeat !important'></div>");
                }
            }
        });

        // Now, this is where we create the plugin and call it createGame.
        $.fn.extend({ createGame:function(pieces){
            // Grab the id of the HTML element into which we are placing the game,
            // it is the selector - "#target" from  $("#target").createGame(150);
            var targetElement = "#" + $(this).attr("id");
            tileWidth = Math.floor(imgWidth / pieces);
            tileHeight = Math.floor(imgHeight / pieces);
            totalTiles = tileCount*tileCount;
            tileSequence = [];
            for (var i=0; i<totalTiles; i++){
                tileSequence.push(i);
            }
            randomEmptyTile = Math.ceil(Math.random() * totalTiles);
            $(targetElement).html("<div id = 'board'></div>");
            $("#board").css({ position:'absolute', width: imgWidth, height: imgHeight});
                // Populate the game board's HTML container with 15 squares
                tileSequence.sort(function(a, b){return 0.5 - Math.random()});
                for (var i = 0; i < totalTiles; i++){
                // A dirty way to create an arbitrary DIV and
                // append it into HTML dynamically
                // Notice each square uses the same image earth_img_638x957.jpg
                // It just uses a different x/y offset for each square
                $("#board").append("<div data-sequence = " + tileSequence[i] + " style = 'position: absolute; left: " + ((i % tileCount) * tileWidth) + "px; top: " + Math.floor(i / tileCount) * tileHeight + "px; width: " + tileWidth + "px; height: " + tileHeight + "px; text-align: center; line-height: " + tileHeight + "px; -moz-box-shadow: inset 0 0 20px #555555; -webkit-box-shadow: inset 0 0 20px #555555; box-shadow: inset 0 0 20px #555555; background: #ffffff url(../Picture_Puzzle/assets/images/img_638x957.jpg) " + (-(tileSequence[i] % tileCount) * tileWidth) + "px " + -Math.floor(tileSequence[i] / tileCount) * tileHeight + "px no-repeat !important'></div>");
            }
            // Empty up the 16th square, as the starting point
            // totalTiles = 16
            $("#board").children("div:nth-child(" + randomEmptyTile + ")").css({backgroundImage: " ", background: "#ffffff"});
            // Attach click event to each square
            $("#board").children("div").click(function(){
                Move(this, tileWidth, tileHeight);
            });
            }
        });

        // Move() is the function that is called when a square is clicked
        // Note that it is independent of the plugin itself which is described above
        // It takes two parameters,
        //     1. object handle to the square that was clicked, and
        //     2. the width of the square
        function Move(clicked_square, tileWidth, tileHeight){
        // We need to locate movable tiles based on where the empty spot is,
        // We can only move the four surrounding squares
            var movable = false;
            // Swap x/y between the clicked square and the currently empty square
            var oldx = $("#board").children("div:nth-child(" + randomEmptyTile + ")").css("left");
            var oldy = $("#board").children("div:nth-child(" + randomEmptyTile + ")").css("top");
            var newx = $(clicked_square).css("left");
            var newy = $(clicked_square).css("top");
            // The clicked square is north of the empty square
            if (oldx == newx && newy == (parseInt(oldy) - tileHeight) + 'px'){
                movable = true;
            };
            // The clicked square is south of the empty square
            if (oldx == newx && newy == (parseInt(oldy) + tileHeight) + 'px'){
                movable = true;
            };
            // The clicked square is west of the empty square
            if ((parseInt(oldx) - tileWidth) + 'px' == newx && newy == oldy){
                movable = true;
            };
            // The clicked square is east of the empty square
            if ((parseInt(oldx) + tileWidth) + 'px' == newx && newy == oldy){
                movable = true;
            };
            if (movable){
                // Increment zindex so the new tile is always on top of all others
                $(clicked_square).css("z-index", zi++);
                // Swap squaresâ€¦ Animate new square into old square position
                $(clicked_square).animate({ left: oldx, top: oldy }, 200, function(){
                    //Move old square into new square position
                    $("#board").children("div:nth-child(" + randomEmptyTile + ")").css("left", newx);
                    $("#board").children("div:nth-child(" + randomEmptyTile + ")").css("top", newy);
                });
            };
        };
    // Ok, we're ready to initialize the game, let's do it.
    // Create a game with 4 X 4 tiles inside "#target" div:
    $(document).on("click", ".btn", function(){
        event.preventDefault();
        tileCount = parseInt($(this).attr("data-tileCount"));
        $("#target").sortedTiles(tileCount);
        return tileCount;
    });

    $(document).on("click", "#start", function(){
        event.preventDefault();
        if(tileCount != undefined && gameStarted === false){
            $("#target").createGame(tileCount);
            $(".btn").hide();
            var newBTN = $("<button class='btn-primary' id='giveUp'>I GIVE UP!</button>");
            var hintBTN = $("<button class='btn-primary' id='hint'>" + numHint + "hints</button>");
            $("#btns").append(hintBTN, newBTN);
            gameStarted = true;
        }else if(tileCount == undefined){
            alert("Select a difficulty!!!");
        }
    });

    $(document).on("click", "#giveUp", function(){
        event.preventDefault();
    });

    $(document).on("click", "#hint", function (){
        event.preventDefault();
        if(numHint > 1){
            $("#hiddenImg").fadeIn(1000);
            $("#hiddenImg").delay(2000).fadeOut(1000);
            numHint--;
            $("#hint").text(numHint + "hints");
        }else if (numHint > 0){
            $("#hiddenImg").fadeIn(1000);
            $("#hiddenImg").delay(2000).fadeOut(1000);
            numHint--;
            $("#hint").text(numHint + "hint");
        }else{
            alert("Show me your money");
        }
    });
    </script>
</body>
</html>
