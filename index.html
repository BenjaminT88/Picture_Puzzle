<!DOCTYPE>

<html>
<head>
  <title>GIF Puzzle - jQuery Plugin</title>
</head>
<body>
    <div id="target"></div>

    <script src="https://www.gstatic.com/firebasejs/4.12.0/firebase.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">
        // This is where we initialize the game
        $(document).ready(function(){
            // Initialize the game and create the plugin
            // When the squares swap places, the moving square must always appear on top
            var zi = 1; 
            // We increment z-index each time a square is shifted
            // The index of the empty square by default, the 16th square
            var EmptySquare = 9;

            var randomEmpty = Math.floor(Math.random()*EmptySquare);
            var arrayLoc = [0,1,2,3,4,5,6,7,8];

            // Now, this is where we create the plugin and call it fifteen.
            $.fn.extend({ fifteen:function(square_size){
                // Grab the id of the HTML element into which we are placing the game,
                // it is the selector - "#target" from  $("#target").fifteen(150);
                var targetElement = "#" + $(this).attr("id");
                var sqSize = square_size + 'px';
                var boardSize = (square_size * 3) + 'px';// Inject DIV into target, this is our game board
                $(targetElement).html("<div id = 'board'></div>");
                $("#board").css({ position:'absolute', width: boardSize, height: boardSize, border: '1px solid gray' });
                    // Populate the game board's HTML container with 15 squares
                    arrayLoc.sort(function(a, b){return 0.5 - Math.random()});
                    for (var i = 0; i < EmptySquare; i++){
                    // A dirty way to create an arbitrary DIV and
                    // append it into HTML dynamically
                    // Notice each square uses the same image earth_img_600x600.jpg
                    // It just uses a different x/y offset for each square


                    $("#board").append("<div data-value='" + arrayLoc[i] + "' style = 'position: absolute; left: " + ((i % 3) * square_size) + "px; top: " + Math.floor(i / 3) * square_size + "px; width: " + square_size + "px; height: " + square_size + "px; text-align: center; line-height: " + square_size + "px; -moz-box-shadow: inset 0 0 20px #555555; -webkit-box-shadow: inset 0 0 20px #555555; box-shadow: inset 0 0 20px #555555; background: #ffffff url(../Picture_Puzzle/assets/images/earth_img_600x600.jpg) " + (-(arrayLoc[i] % 3) * square_size) + "px " + -Math.floor(arrayLoc[i] / 3) * square_size + "px no-repeat !important'></div>");

                }
                // Empty up the 16th square, as the starting point
                // EmptySquare = 16
                    $("#board").children("div:nth-child(" + randomEmpty + ")").css({backgroundImage: "", background: "#ffffff"});
                // Attach click event to each square
                    $("#board").children("div").click(function()
                {
                Move(this, square_size);
                });
                }
            });
            // Move() is the function that is called when a square is clicked
            // Note that it is independent of the plugin itself which is described above
            // It takes two parameters,
            //     1. object handle to the square that was clicked, and
            //     2. the width of the square
            function Move(clicked_square, square_size){
            // We need to locate movable tiles based on where the empty spot is,
            // We can only move the four surrounding squares
                var movable = false;
                // Swap x/y between the clicked square and the currently empty square
                var oldx = $("#board").children("div:nth-child(" + randomEmpty + ")").css("left");
                var oldy = $("#board").children("div:nth-child(" + randomEmpty + ")").css("top");
                var newx = $(clicked_square).css("left");
                var newy = $(clicked_square).css("top");
                // The clicked square is north of the empty square
                if (oldx == newx && newy == (parseInt(oldy) - square_size) + 'px'){
                    movable = true;
                };
                // The clicked square is south of the empty square
                if (oldx == newx && newy == (parseInt(oldy) + square_size) + 'px'){
                    movable = true;
                };
                // The clicked square is west of the empty square
                if ((parseInt(oldx) - square_size) + 'px' == newx && newy == oldy){
                    movable = true;
                };
                // The clicked square is east of the empty square
                if ((parseInt(oldx) + square_size) + 'px' == newx && newy == oldy){
                    movable = true;
                };
                if (movable){
                    // Increment zindex so the new tile is always on top of all others
                    $(clicked_square).css("z-index", zi++);
                    // Swap squaresâ€¦ Animate new square into old square position
                    $(clicked_square).animate({ left: oldx, top: oldy }, 200, function(){
                        //Move old square into new square position
                        $("#board").children("div:nth-child(" + randomEmpty + ")").css("left", newx);
                        $("#board").children("div:nth-child(" + randomEmpty + ")").css("top", newy);
                    });
                };
            };
        // Ok, we're ready to initialize the game, let's do it.
        // Create a game with 150 by 150 squares inside "#target" div:
            $("#target").fifteen(200);
        });
    </script>
</body>
</html>